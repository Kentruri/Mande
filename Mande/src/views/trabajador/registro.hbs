<link href="/css/registro.css" rel="stylesheet">

<div class="row no-gutters bg-dark">
    <div class="col-xl-5 col-lg-12 register-bg">

    </div>
    <div class="col-xl-7 col-lg-12 d-flex">
        <div class="container align-self-center p-6">
            <h1 class="font-weight-bold mb-3">Registrate</h1>

            <p class="text-muted mb-5">Ingresa la siguiente información para registrarte.</p>

            <form action="/trabajador/registro" method="POST">

                <div class="form-row mb-2">

                    <div class="form-group col-md-7">
                        <label class="font-weight-bold">Nombre </label>
                        <input type="text" class="form-control" name="trabajador_nombre" autocomplete="off" required
                            placeholder="Tu nombre">
                    </div>

                    <div class="form-group col-md-5">
                        <label>Fecha de nacimiento</label>
                        <input type="date" name="trabajador_fechaNacimiento" class="form-control" required>
                    </div>

                </div>

                <div class="form-group mb-3">
                    <label>Dirección</label>
                    <input type="text" class="form-control" id="search_input" name="trabajador_direccion" required>
                    <input type="hidden" name="trabajador_latitud" id="latitude" />
                    <input type="hidden" name="trabajador_longitud" id="longitude" />
                </div>

                <div class="form-group mb-3">
                    <label>No. Documento</label>
                    <input type="text" class="form-control" name="id_trabajador" required
                        placeholder="Tu direccion de domicilio">
                </div>


                <div class="form-row mb-2">

                    <div class="form-group col-md-5">
                        <label class="font-weight-bold">Usuario</label>
                        <input type="text" class="form-control" name="trabajador_username" autocomplete="off" required
                            placeholder="Tu nombre de usuario">
                    </div>

                    <div class="form-group col-md-7">
                        <label class="font-weight-bold">Contraseña </label>
                        <input type="password" class="form-control" name="trabajador_password" autocomplete="off"
                            required placeholder="tu contraseña">
                    </div>

                </div>




                <button class="btn btn-primary width-100">Regístrate</button>
            </form>
            <small class="d-inline-block text-muted mt-5">© Mande Corp 2020</small>
        </div>
    </div>
</div>

<script>
    // ADDRESS
    var searchInput = 'search_input';

    $(document).ready(function () {
        var autocomplete;
        autocomplete = new google.maps.places.Autocomplete((document.getElementById(searchInput)),
            {
                types: ['geocode']
            });

        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var near_place = autocomplete.getPlace();

            document.getElementById('latitude').value = near_place.geometry.location.lat();
            document.getElementById('longitude').value = near_place.geometry.location.lng();
        });
    });

    $(document).on('change', '#' + searchInput, function () {
        document.getElementById('latitude').value = '';
        document.getElementById('longitude').value = '';
    });

    // FOTO
    const imagePreview = document.getElementById('img_preview');
    const imageUploader = document.getElementById('img_uploader');

    const CLOUDINARY_URL = 'https://api.cloudinary.com/v1_1/mattezl/image/upload';
    const CLOUDINARY_UPLOAD_PRESET = 'bz4oq8ph';

    imageUploader.addEventListener('change', async (e) => {
        const file = e.target.files[0];

        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
        const res = await axios.post(CLOUDINARY_URL, formData,
            {
                headers:
                {
                    'Content-Type': 'multipart/form-data'
                }
            });
        console.log(res);
        imagePreview.src = res.data.secure_url;
        document.getElementById('foto').value = res.data.secure_url;

    })

    // DOCUMENTO
    const docPreview = document.getElementById('doc_preview');
    const docUploader = document.getElementById('doc_uploader');

    docUploader.addEventListener('change', async (e) => {
        const file = e.target.files[0];

        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
        const res = await axios.post(CLOUDINARY_URL, formData,
            {
                headers:
                {
                    'Content-Type': 'multipart/form-data'
                }
            });
        console.log(res);
        docPreview.src = res.data.secure_url;
        document.getElementById('documento').value = res.data.secure_url;
    })
</script>